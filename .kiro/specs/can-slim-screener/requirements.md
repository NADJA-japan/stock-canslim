# 要件ドキュメント

## はじめに

CAN-SLIM US Stock Hunterは、米国株式市場からCAN-SLIM基準を満たす成長株を自動的にスクリーニングし、チャート画像と主要指標をSlackに投稿するシステムです。このシステムは、S&P500やNasdaq100などの主要銘柄群を対象に、テクニカル分析とファンダメンタル分析を組み合わせた2段階フィルタリングを実行します。

## 用語集

- **システム**: CAN-SLIM US Stock Hunter アプリケーション
- **ユーザー**: システムを実行する投資家またはトレーダー
- **ティッカー**: 株式銘柄コード（例: AAPL, NVDA）
- **テクニカルフィルター**: 株価データに基づく第1段階のスクリーニング
- **ファンダメンタルフィルター**: 財務データに基づく第2段階のスクリーニング
- **CAN-SLIM基準**: William O'Neilが提唱する成長株選定基準
- **EPS**: Earnings Per Share（1株当たり利益）
- **ROE**: Return on Equity（自己資本利益率）
- **SMA**: Simple Moving Average（単純移動平均線）
- **RS**: Relative Strength（相対力指数）
- **Slackチャンネル**: 通知先のSlackチャンネル

## 要件

### 要件1

**ユーザーストーリー:** ユーザーとして、事前定義された銘柄リストを読み込みたい。そうすることで、システムが主要市場構成銘柄を効率的にスクリーニングできるようにするため。

#### 受け入れ基準

1. システムが実行を開始したとき、システムはCSVファイルまたはPythonリストからティッカーリストを読み込むものとする
2. ティッカーリストがS&P500構成銘柄を含むとき、システムはすべての有効なティッカーシンボルを受け入れるものとする
3. ティッカーリストがNasdaq100構成銘柄を含むとき、システムはすべての有効なティッカーシンボルを受け入れるものとする
4. ティッカーリストが無効なティッカーシンボルを含むとき、システムはそれらのシンボルをスキップし、有効なシンボルの処理を継続するものとする
5. システムは1から10,000個のシンボルを含むティッカーリストをサポートするものとする

### 要件2

**ユーザーストーリー:** ユーザーとして、システムが最初にテクニカルフィルターを適用してほしい。そうすることで、高コストなファンダメンタルデータ取得の前に不適格な銘柄を除外し、処理時間を最小化するため。

#### 受け入れ基準

1. システムがティッカーを処理するとき、システムはyfinanceを使用して過去252取引日の日次株価データを取得するものとする
2. 現在の株価が10ドル以下であるとき、システムはそのティッカーをそれ以降の処理から除外するものとする
3. 50日平均出来高が200,000株以下であるとき、システムはそのティッカーをそれ以降の処理から除外するものとする
4. 現在の株価が200日単純移動平均線以下であるとき、システムはそのティッカーをそれ以降の処理から除外するものとする
5. 現在の株価が52週高値の85%未満であるとき、システムはそのティッカーをそれ以降の処理から除外するものとする
6. ティッカーの1年間リターンがS&P500指数リターン以下であるとき、システムはそのティッカーをそれ以降の処理から除外するものとする
7. ティッカーがすべてのテクニカルフィルターを通過したとき、システムはそのティッカーをファンダメンタル分析の候補リストに追加するものとする

### 要件3

**ユーザーストーリー:** ユーザーとして、システムがテクニカル的に適格な銘柄にファンダメンタルフィルターを適用してほしい。そうすることで、CAN-SLIMの収益性と利益性基準を満たす銘柄のみを特定するため。

#### 受け入れ基準

1. システムが候補ティッカーを処理するとき、システムはyfinanceを使用して四半期財務データを取得するものとする
2. 直近四半期のEPS成長率が1年前の同四半期と比較して20%以上であるとき、システムはそのティッカーを現在収益基準を満たすものとしてマークするものとする
3. 直近四半期の売上成長率が1年前の同四半期と比較して20%以上であるとき、システムはそのティッカーを現在収益基準を満たすものとしてマークするものとする
4. 直近年度のROEが15%以上であるとき、システムはそのティッカーを年間収益基準を満たすものとしてマークするものとする
5. ティッカーが現在収益基準と年間収益基準の両方を満たすとき、システムはそのティッカーを適格なCAN-SLIM銘柄として分類するものとする
6. ティッカーの財務データが利用できないとき、システムはエラーを発生させずにそのティッカーをスキップするものとする

### 要件4

**ユーザーストーリー:** ユーザーとして、システムが適格銘柄のチャート画像を生成してほしい。そうすることで、価格トレンドとテクニカルパターンを視覚的に評価できるようにするため。

#### 受け入れ基準

1. システムが適格なCAN-SLIM銘柄を特定したとき、システムはmplfinanceを使用してローソク足チャートを生成するものとする
2. チャートを生成するとき、システムは過去252取引日の日次株価データを含めるものとする
3. チャートを生成するとき、システムは50日単純移動平均線を青色で重ねて表示するものとする
4. チャートを生成するとき、システムは200日単純移動平均線を赤色で重ねて表示するものとする
5. チャートを生成するとき、システムは下部パネルに出来高バーを表示するものとする
6. チャートを生成するとき、システムは画像を"chart_{TICKER}.png"のファイル名形式でPNGファイルとして保存するものとする
7. チャートを生成するとき、システムはSlackでの可読性のためにダークテーマスタイルを使用するものとする

### 要件5

**ユーザーストーリー:** ユーザーとして、システムが企業情報と最新ニュースを取得してほしい。そうすることで、数値指標以外の適格銘柄に関する文脈情報を得られるようにするため。

#### 受け入れ基準

1. システムが適格なCAN-SLIM銘柄を特定したとき、システムはyfinanceを使用して企業のセクターを取得するものとする
2. システムが適格なCAN-SLIM銘柄を特定したとき、システムはyfinanceを使用して企業の業種を取得するものとする
3. システムがティッカーのニュースを取得するとき、システムはタイトルとURLを含む最新ニュース項目を最低1件、最大2件取得するものとする
4. ティッカーのニュースデータが利用できないとき、システムはエラーを発生させずに処理を継続するものとする

### 要件6

**ユーザーストーリー:** ユーザーとして、システムが適格銘柄を包括的な情報とともにSlackに投稿してほしい。そうすることで、コミュニケーションプラットフォーム上で投資機会を確認できるようにするため。

#### 受け入れ基準

1. システムが適格なCAN-SLIM銘柄を特定したとき、システムはslack_sdkを使用して設定されたSlackチャンネルにメッセージを投稿するものとする
2. Slackに投稿するとき、システムはメッセージタイトルにティッカーシンボル、企業名、現在の株価を含めるものとする
3. Slackに投稿するとき、システムはメッセージ本文に四半期EPS成長率パーセンテージを含めるものとする
4. Slackに投稿するとき、システムはメッセージ本文に四半期売上成長率パーセンテージを含めるものとする
5. Slackに投稿するとき、システムはメッセージ本文に年間ROEパーセンテージを含めるものとする
6. Slackに投稿するとき、システムはメッセージ本文に市場と比較した相対力評価を含めるものとする
7. Slackに投稿するとき、システムはティッカーのYahoo FinanceとTradingViewへのクリック可能なリンクを含めるものとする
8. Slackに投稿するとき、システムは生成されたチャート画像をメッセージに添付するものとする
9. Slackに投稿するとき、システムは取得したニュース項目をタイトルとURLとともにメッセージ本文に含めるものとする

### 要件7

**ユーザーストーリー:** ユーザーとして、システムがAPIレート制限を適切に処理してほしい。そうすることで、データプロバイダーによってブロックされることなくスクリーニングプロセスが正常に完了するようにするため。

#### 受け入れ基準

1. システムがティッカーの詳細財務データを取得するとき、システムは次のティッカーを処理する前に少なくとも1秒間待機するものとする
2. システムがAPIレート制限エラーに遭遇したとき、システムはエラーをログに記録し、残りのティッカーの処理を継続するものとする
3. システムがネットワークタイムアウトに遭遇したとき、システムは指数バックオフで最大3回までリクエストを再試行するものとする

### 要件8

**ユーザーストーリー:** ユーザーとして、システムが欠損データや無効なデータを適切に処理してほしい。そうすることで、一部の銘柄に不完全な情報があってもスクリーニングプロセスが継続するようにするため。

#### 受け入れ基準

1. システムがティッカーの株価データの欠損に遭遇したとき、システムはそのティッカーをスキップし、警告メッセージをログに記録するものとする
2. システムがティッカーの財務データの欠損に遭遇したとき、システムはそのティッカーをスキップし、警告メッセージをログに記録するものとする
3. システムが無効なティッカーシンボルに遭遇したとき、システムはそのティッカーをスキップし、警告メッセージをログに記録するものとする
4. システムが処理を完了したとき、システムは処理されたティッカー、適格となったティッカー、スキップされたティッカーの総数を報告するものとする

### 要件9

**ユーザーストーリー:** ユーザーとして、システムが設定可能な閾値を使用してほしい。そうすることで、コードを変更せずにスクリーニング基準を調整できるようにするため。

#### 受け入れ基準

1. システムは最低株価閾値を設定ファイルまたは定数から読み取るものとする
2. システムは最低平均出来高閾値を設定ファイルまたは定数から読み取るものとする
3. システムはEPS成長率閾値を設定ファイルまたは定数から読み取るものとする
4. システムは売上成長率閾値を設定ファイルまたは定数から読み取るものとする
5. システムはROE閾値を設定ファイルまたは定数から読み取るものとする
6. システムは高値近辺パーセンテージ閾値を設定ファイルまたは定数から読み取るものとする
7. システムはSlackチャンネル名を設定ファイルまたは定数から読み取るものとする

### 要件10

**ユーザーストーリー:** ユーザーとして、適格銘柄のExit戦略指標を計算してほしい。そうすることで、利益確定と損切りの判断基準を事前に把握できるようにするため。

#### 受け入れ基準

1. システムが適格なCAN-SLIM銘柄を特定したとき、システムは利益確定Exit指標を計算するものとする
2. 利益確定Exit指標を計算するとき、システムは現在株価から20%上昇した価格を目標価格として算出するものとする
3. 利益確定Exit指標を計算するとき、システムは株価が10日移動平均線を下回った場合をExit条件として設定するものとする
4. システムが適格なCAN-SLIM銘柄を特定したとき、システムは損切りExit指標を計算するものとする
5. 損切りExit指標を計算するとき、システムは現在株価から7%下落した価格を損切り価格として算出するものとする
6. 損切りExit指標を計算するとき、システムは株価が50日移動平均線を大きく下回った場合（3%以上）を追加のExit条件として設定するものとする

### 要件11

**ユーザーストーリー:** ユーザーとして、Slack投稿にExit戦略情報を含めてほしい。そうすることで、投資判断と同時に出口戦略も確認できるようにするため。

#### 受け入れ基準

1. Slackに投稿するとき、システムは利益確定Exit条件をメッセージ本文に含めるものとする
2. 利益確定Exit条件を投稿するとき、システムは目標価格（現在価格+20%）を表示するものとする
3. 利益確定Exit条件を投稿するとき、システムは「株価が10日移動平均線を下回ったら利益確定を検討」という理由を表示するものとする
4. Slackに投稿するとき、システムは損切りExit条件をメッセージ本文に含めるものとする
5. 損切りExit条件を投稿するとき、システムは損切り価格（現在価格-7%）を表示するものとする
6. 損切りExit条件を投稿するとき、システムは「株価が購入価格から7%下落、または50日移動平均線を3%以上下回ったら損切り」という理由を表示するものとする
