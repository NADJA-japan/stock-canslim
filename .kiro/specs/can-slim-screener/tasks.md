# 実装計画

- [x] 1. プロジェクト構造とコア設定のセットアップ





  - プロジェクトディレクトリ構造を作成（modules/, output/, tests/）
  - requirements.txtを作成（yfinance, pandas, numpy, mplfinance, slack_sdk, hypothesis, pytest）
  - config.pyを実装（スクリーニング基準、Exit戦略パラメータ、Slack設定、データソース設定）
  - .envファイルのテンプレートを作成（SLACK_BOT_TOKEN用）
  - ロギング設定を実装
  - _要件: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7_

- [x] 2. データモデルの実装




  - [x] 2.1 データクラスの定義


    - StockData、FinancialMetrics、ExitStrategy、NewsItemのデータクラスを実装
    - 型ヒントとdocstringを追加
    - _要件: 1.1, 3.2, 3.3, 3.4, 5.3, 10.2, 10.5_

- [x] 3. DataLoaderモジュールの実装





  - [x] 3.1 ティッカーリスト読み込み機能


    - load_ticker_list()メソッドを実装（CSV/リスト対応）
    - 無効なティッカーのフィルタリングロジック
    - エラーハンドリング（ファイルが存在しない場合）
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_
  
  - [ ]* 3.2 ティッカーリスト読み込みのプロパティテスト
    - **プロパティ1: ティッカーリスト読み込みの一貫性**
    - **検証: 要件 1.1**
  
  - [ ]* 3.3 無効ティッカースキップのプロパティテスト
    - **プロパティ2: 無効ティッカーのスキップ**
    - **検証: 要件 1.4**
  
  - [x] 3.4 株価データ取得機能


    - fetch_price_data()メソッドを実装（yfinance使用）
    - 過去252取引日のデータ取得
    - リトライロジック（指数バックオフ、最大3回）
    - エラーハンドリング（タイムアウト、レート制限）
    - _要件: 2.1, 7.1, 7.2, 7.3, 8.1_
  
  - [x] 3.5 財務データ取得機能


    - fetch_financial_data()メソッドを実装
    - 四半期財務データの取得
    - エラーハンドリング（データ欠損）
    - _要件: 3.1, 3.6, 8.2_
  
  - [x] 3.6 企業情報とニュース取得機能


    - fetch_company_info()メソッドを実装（セクター、業種）
    - fetch_news()メソッドを実装（最大2件）
    - エラーハンドリング（ニュースデータ欠損）
    - _要件: 5.1, 5.2, 5.3, 5.4_
  
  - [ ]* 3.7 ニュース取得のプロパティテスト
    - **プロパティ15: ニュース取得数の制約**
    - **検証: 要件 5.3**

- [x] 4. TechnicalFilterクラスの実装






  - [x] 4.1 個別フィルターメソッドの実装

    - apply_price_filter()（$10以上）
    - apply_volume_filter()（50日平均200k以上）
    - apply_trend_filter()（200MA以上）
    - apply_near_high_filter()（52週高値の85%以上）
    - apply_rs_filter()（SPYを上回る）
    - _要件: 2.2, 2.3, 2.4, 2.5, 2.6_
  
  - [ ]* 4.2 株価フィルターのプロパティテスト
    - **プロパティ3: 株価フィルターの正確性**
    - **検証: 要件 2.2**
  
  - [ ]* 4.3 出来高フィルターのプロパティテスト
    - **プロパティ4: 出来高フィルターの正確性**
    - **検証: 要件 2.3**
  
  - [ ]* 4.4 トレンドフィルターのプロパティテスト
    - **プロパティ5: トレンドフィルターの正確性**
    - **検証: 要件 2.4**
  
  - [ ]* 4.5 新高値近辺フィルターのプロパティテスト
    - **プロパティ6: 新高値近辺フィルターの正確性**
    - **検証: 要件 2.5**
  
  - [ ]* 4.6 相対力フィルターのプロパティテスト
    - **プロパティ7: 相対力フィルターの正確性**
    - **検証: 要件 2.6**
  

  - [x] 4.7 統合フィルターメソッドの実装


    - filter_all()メソッドを実装（すべてのフィルターを順次適用）
    - 候補リストの生成
    - _要件: 2.7_
  
  - [ ]* 4.8 テクニカルフィルター通過のプロパティテスト
    - **プロパティ8: テクニカルフィルター通過の一貫性**
    - **検証: 要件 2.7**

- [x] 5. FundamentalFilterクラスの実装




  - [x] 5.1 収益基準チェックメソッドの実装


    - check_current_earnings()（EPS成長率20%以上 OR 売上成長率20%以上）
    - check_annual_earnings()（ROE 15%以上）
    - _要件: 3.2, 3.3, 3.4_
  
  - [ ]* 5.2 EPS成長率判定のプロパティテスト
    - **プロパティ9: EPS成長率判定の正確性**
    - **検証: 要件 3.2**
  
  - [ ]* 5.3 売上成長率判定のプロパティテスト
    - **プロパティ10: 売上成長率判定の正確性**
    - **検証: 要件 3.3**
  
  - [ ]* 5.4 ROE判定のプロパティテスト
    - **プロパティ11: ROE判定の正確性**
    - **検証: 要件 3.4**
  
  - [x] 5.5 適格判定メソッドの実装

    - is_qualified()メソッドを実装（C基準とA基準の両方を満たす）
    - メトリクス辞書の生成
    - _要件: 3.5_
  
  - [ ]* 5.6 CAN-SLIM適格判定のプロパティテスト
    - **プロパティ12: CAN-SLIM適格判定の正確性**
    - **検証: 要件 3.5**

- [x] 6. ExitStrategyCalculatorクラスの実装





  - [x] 6.1 利益確定戦略の計算


    - calculate_profit_target()メソッドを実装
    - 目標価格計算（現在価格 × 1.20）
    - 10日移動平均線条件の設定
    - _要件: 10.1, 10.2, 10.3_
  
  - [ ]* 6.2 利益確定目標価格のプロパティテスト
    - **プロパティ24: 利益確定目標価格の計算精度**
    - **検証: 要件 10.2**
  

  - [ ] 6.3 損切り戦略の計算
    - calculate_stop_loss()メソッドを実装
    - 損切り価格計算（現在価格 × 0.93）
    - 50日移動平均線条件の設定（3%以上下回る）
    - _要件: 10.4, 10.5, 10.6_
  
  - [ ]* 6.4 損切り価格のプロパティテスト
    - **プロパティ25: 損切り価格の計算精度**
    - **検証: 要件 10.5**

- [x] 7. ChartGeneratorクラスの実装




  - [x] 7.1 チャート生成機能


    - generate_chart()メソッドを実装（mplfinance使用）
    - ローソク足チャートの生成
    - 50日・200日移動平均線の追加
    - 出来高バーの表示
    - ダークテーマスタイルの適用
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 4.7_
  
  - [x] 7.2 ファイル保存機能

    - "chart_{TICKER}.png"形式でのファイル保存
    - outputディレクトリの自動作成
    - エラーハンドリング（ディスク容量不足）
    - _要件: 4.6_
  
  - [ ]* 7.3 チャートファイル名のプロパティテスト
    - **プロパティ14: チャートファイル名の正確性**
    - **検証: 要件 4.6**

- [ ] 8. SlackNotifierクラスの実装
  - [ ] 8.1 メッセージフォーマット機能
    - _format_message()メソッドを実装
    - ティッカーシンボル、企業名、現在株価をタイトルに含める
    - EPS成長率、売上成長率、ROE、相対力評価を本文に含める
    - Exit戦略情報（利益確定・損切り）を本文に含める
    - Yahoo Finance、TradingViewへのリンクを生成
    - ニュース項目を含める
    - _要件: 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.9, 11.1, 11.2, 11.3, 11.4, 11.5, 11.6_
  
  - [ ]* 8.2 Slackメッセージ完全性のプロパティテスト
    - **プロパティ17: Slackメッセージの完全性**
    - **検証: 要件 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.9**
  
  - [ ]* 8.3 Exit戦略情報完全性のプロパティテスト
    - **プロパティ26: Exit戦略情報の完全性**
    - **検証: 要件 11.1, 11.2, 11.3, 11.4, 11.5, 11.6**
  
  - [ ] 8.4 Slack投稿機能
    - post_stock_alert()メソッドを実装
    - _upload_chart()メソッドを実装（画像アップロード）
    - エラーハンドリング（認証エラー、チャンネル不存在）
    - _要件: 6.1, 6.8_

- [ ] 9. メインオーケストレーターの実装
  - [ ] 9.1 main()関数の実装
    - すべてのコンポーネントの初期化
    - ティッカーリスト読み込み
    - 株価データ一括取得（SPYを含む）
    - テクニカルフィルタリング実行
    - _要件: 1.1, 2.1, 2.7_
  
  - [ ] 9.2 ファンダメンタルフィルタリングループ
    - 候補ティッカーのループ処理
    - API呼び出し間隔の制御（1秒待機）
    - 財務データ取得と適格判定
    - エラーハンドリング（スキップして継続）
    - _要件: 3.1, 3.5, 7.1, 7.2, 8.2_
  
  - [ ]* 9.3 API呼び出し間隔のプロパティテスト
    - **プロパティ18: API呼び出し間隔の遵守**
    - **検証: 要件 7.1**
  
  - [ ] 9.4 出力生成と通知ループ
    - Exit戦略の計算
    - チャート画像の生成
    - 企業情報・ニュースの取得
    - Slack投稿
    - エラーハンドリング（スキップして継続）
    - _要件: 4.1, 5.1, 5.2, 5.3, 6.1, 10.1, 10.4_
  
  - [ ] 9.5 処理サマリーの出力
    - 処理済み、適格、スキップの各カウント
    - ログ出力
    - _要件: 8.4_
  
  - [ ]* 9.6 処理サマリー正確性のプロパティテスト
    - **プロパティ23: 処理サマリーの正確性**
    - **検証: 要件 8.4**

- [ ] 10. エラーハンドリングとロギングの強化
  - [ ] 10.1 リトライロジックの実装
    - fetch_with_retry()ヘルパー関数
    - 指数バックオフの実装
    - _要件: 7.3_
  
  - [ ]* 10.2 ネットワークタイムアウトリトライのプロパティテスト
    - **プロパティ20: ネットワークタイムアウト時のリトライ**
    - **検証: 要件 7.3**
  
  - [ ] 10.3 データ欠損ハンドリング
    - safe_process_ticker()ヘルパー関数
    - 警告ログの記録
    - _要件: 8.1, 8.2, 8.3_
  
  - [ ]* 10.4 データ欠損時ログ記録のプロパティテスト
    - **プロパティ21: データ欠損時のログ記録**
    - **検証: 要件 8.1, 8.2**
  
  - [ ]* 10.5 無効ティッカー時ログ記録のプロパティテスト
    - **プロパティ22: 無効ティッカー時のログ記録**
    - **検証: 要件 8.3**

- [ ] 11. サンプルデータとドキュメントの作成
  - サンプルティッカーリストCSVを作成（S&P500の一部）
  - README.mdを作成（セットアップ手順、使用方法）
  - .env.exampleを作成（環境変数のテンプレート）
  - 実行例のドキュメント

- [ ] 12. GitHub Actions CI/CDセットアップ
  - [ ] 12.1 GitHub Actionsワークフローファイルの作成
    - .github/workflows/test.ymlを作成
    - Python 3.9+のセットアップ
    - 依存関係のインストール（requirements.txt）
    - pytestの実行（ユニットテスト）
    - Hypothesisプロパティテスト実行（--hypothesis-profile=ci）
    - テストカバレッジレポートの生成
  
  - [ ] 12.2 GitHub Actionsスケジュール実行ワークフローの作成
    - .github/workflows/daily-screening.ymlを作成
    - cronスケジュール設定（例：毎日市場終了後）
    - 環境変数の設定（LINE_CHANNEL_ACCESS_TOKEN等）
    - main.pyの実行
    - エラー時の通知設定
  
  - [ ] 12.3 GitHub Secretsの設定ドキュメント
    - README.mdにSecrets設定手順を追加
    - LINE_CHANNEL_ACCESS_TOKENの設定方法
    - その他必要な環境変数のリスト

- [ ] 13. チェックポイント - GitHub Actionsでテストが通ることを確認
  - GitHub Actionsでテストワークフローが正常に実行されることを確認
  - プロパティベーステストが100回反復で成功することを確認
  - 問題があればユーザーに質問する
